<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>003-Nacos服务注册与配置中心 | MYH'Blog</title><meta name="description" content="">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/assets/style-605ca4f8.css" as="style"><link rel="stylesheet" href="/blog/assets/style-605ca4f8.css">
    <link rel="modulepreload" href="/blog/assets/app-f0ac02dd.js"><link rel="modulepreload" href="/blog/assets/003-Nacos服务注册与配置中心.html-a3564172.js"><link rel="modulepreload" href="/blog/assets/003-Nacos服务注册与配置中心.html-a6c4792a.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/blog/assets/index.html-15f7938e.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-184d87ee.js" as="script"><link rel="prefetch" href="/blog/assets/001-SpringBoot概述.html-87e6b62a.js" as="script"><link rel="prefetch" href="/blog/assets/002-HelloWorld解析.html-dc34e1af.js" as="script"><link rel="prefetch" href="/blog/assets/001-微服务与SpringCloud.html-6e094cc2.js" as="script"><link rel="prefetch" href="/blog/assets/002-SpringCloud案例项目搭建.html-aa946cc9.js" as="script"><link rel="prefetch" href="/blog/assets/001-修改浏览器滚动条样式.html-5ab44ac8.js" as="script"><link rel="prefetch" href="/blog/assets/001-前端实现文件下载.html-055a7334.js" as="script"><link rel="prefetch" href="/blog/assets/001-Vue的介绍与安装.html-80f9d4d7.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dd7bf623.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2928edae.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f98d9a2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7325e627.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6261e7cc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-19c95a4a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3b59c2e7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-88930a72.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-19de02d9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2e547c56.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-71fc6e23.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b8bdf50b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-335eb9db.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-d53ac3af.js" as="script"><link rel="prefetch" href="/blog/assets/001-SpringBoot概述.html-fa967209.js" as="script"><link rel="prefetch" href="/blog/assets/002-HelloWorld解析.html-91a042cc.js" as="script"><link rel="prefetch" href="/blog/assets/001-微服务与SpringCloud.html-c9f5c2d1.js" as="script"><link rel="prefetch" href="/blog/assets/002-SpringCloud案例项目搭建.html-167e5052.js" as="script"><link rel="prefetch" href="/blog/assets/001-修改浏览器滚动条样式.html-ccd37e17.js" as="script"><link rel="prefetch" href="/blog/assets/001-前端实现文件下载.html-1a88b8d3.js" as="script"><link rel="prefetch" href="/blog/assets/001-Vue的介绍与安装.html-da6e9a77.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-4b140091.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a92c788b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4f89037c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-be90317d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-62b644d4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ea3a2656.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0623ff8c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-68a3a415.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b49baa7e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-17e4f223.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ddd1c99c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f7e35363.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ed5d16ad.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-166644b4.js" as="script"><link rel="prefetch" href="/blog/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/blog/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/blog/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/blog/assets/mermaid.core-801b763c.js" as="script"><link rel="prefetch" href="/blog/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/blog/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/blog/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/blog/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/blog/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/blog/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/blog/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/blog/assets/VuePlayground-e3f2c426.js" as="script"><link rel="prefetch" href="/blog/assets/photoswipe.esm-2450701e.js" as="script"><link rel="prefetch" href="/blog/assets/SearchResult-045be707.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="md-link vp-brand" href="/blog/"><img class="vp-nav-logo" src="/blog/avatar.png" alt="MYH&#39;Blog"><!----><span class="vp-site-name hide-in-pad">MYH&#39;Blog</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="md-link nav-link" href="/blog/"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="后端"><span class="title"><span class="font-icon icon iconfont icon-back" style=""></span>后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="md-link nav-link" href="/blog/back/springboot.html"><span class="font-icon icon iconfont icon-springboot" style=""></span>SpringBoot<!----></a></li><li class="dropdown-item"><a class="md-link nav-link active" href="/blog/back/springcloud.html"><span class="font-icon icon iconfont icon-springcloud" style=""></span>SpringCloud<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="前端"><span class="title"><span class="font-icon icon iconfont icon-front" style=""></span>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="md-link nav-link" href="/blog/front/vue.html"><span class="font-icon icon iconfont icon-vue" style=""></span>Vue基础总结<!----></a></li><li class="dropdown-item"><a class="md-link nav-link" href="/blog/front/css.html"><span class="font-icon icon iconfont icon-css" style=""></span>常用CSS样式梳理<!----></a></li><li class="dropdown-item"><a class="md-link nav-link" href="/blog/front/js.html"><span class="font-icon icon iconfont icon-javascript" style=""></span>JavaScript使用技巧<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="数据库"><span class="title"><span class="font-icon icon iconfont icon-database" style=""></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="md-link nav-link" href="/blog/db/mysql.html"><span class="font-icon icon iconfont icon-mysql" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a class="md-link nav-link" href="/blog/db/redis.html"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="md-link nav-link" href="/blog/db/mongo.html"><span class="font-icon icon iconfont icon-mongo" style=""></span>MongoDB<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/mengyahui/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar hide-icon"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a class="md-link nav-link vp-sidebar-link vp-sidebar-page" href="/blog/back/springcloud/001-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8ESpringCloud.html"><!---->001-微服务与SpringCloud<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="md-link nav-link vp-sidebar-link vp-sidebar-page" href="/blog/back/springcloud/002-SpringCloud%E6%A1%88%E4%BE%8B%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA.html"><!---->002-SpringCloud案例项目搭建<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="md-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html"><!---->003-Nacos服务注册与配置中心<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_1-nacos-概述.html"><!---->1-Nacos 概述<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_2-nacos-的下载与安装.html"><!---->2-Nacos 的下载与安装<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_3-nacos-注册中心.html"><!---->3-Nacos 注册中心<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_3-1-服务注册中心介绍.html"><!---->3.1 服务注册中心介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_3-2-搭建-nacos-注册中心.html"><!---->3.2 搭建 Nacos 注册中心<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_3-3-nacos-领域模型.html"><!---->3.3 Nacos 领域模型<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_3-4-nacos-数据模型.html"><!---->3.4 Nacos 数据模型<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-nacos-集群.html"><!---->4 Nacos 集群<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-1-nacos-集群架构.html"><!---->4.1 Nacos 集群架构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-2-数据持久化配置.html"><!---->4.2 数据持久化配置<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-3-搭建-nacos-集群.html"><!---->4.3 搭建 Nacos 集群<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-4-权重策略.html"><!---->4.4 权重策略<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-5-临时-持久化实例.html"><!---->4.5 临时/持久化实例<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_4-6-保护阈值.html"><!---->4.6 保护阈值<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_5-nacos-配置中心.html"><!---->5-Nacos 配置中心<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_5-1-服务配置中心介绍.html"><!---->5.1 服务配置中心介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="md-link nav-link vp-sidebar-link vp-heading" href="/blog/back/springcloud/003-Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.html#_5-2-搭建-nacos-配置中心.html"><!---->5.2 搭建 Nacos 配置中心<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->003-Nacos服务注册与配置中心</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mengyahui.github.io" target="_blank" rel="noopener noreferrer">MYH</a></span><span property="author" content="MYH"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-07-09T01:02:21.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 20 分钟</span><meta property="timeRequired" content="PT20M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="md-link toc-link level2" href="/blog/#_1-nacos-概述.html">1-Nacos 概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level2" href="/blog/#_2-nacos-的下载与安装.html">2-Nacos 的下载与安装</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level2" href="/blog/#_3-nacos-注册中心.html">3-Nacos 注册中心</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_3-1-服务注册中心介绍.html">3.1 服务注册中心介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_3-2-搭建-nacos-注册中心.html">3.2 搭建 Nacos 注册中心</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_3-3-nacos-领域模型.html">3.3 Nacos 领域模型</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_3-4-nacos-数据模型.html">3.4 Nacos 数据模型</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level2" href="/blog/#_4-nacos-集群.html">4 Nacos 集群</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-1-nacos-集群架构.html">4.1 Nacos 集群架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-2-数据持久化配置.html">4.2 数据持久化配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-3-搭建-nacos-集群.html">4.3 搭建 Nacos 集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-4-权重策略.html">4.4 权重策略</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-5-临时-持久化实例.html">4.5 临时/持久化实例</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_4-6-保护阈值.html">4.6 保护阈值</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level2" href="/blog/#_5-nacos-配置中心.html">5-Nacos 配置中心</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_5-1-服务配置中心介绍.html">5.1 服务配置中心介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="md-link toc-link level3" href="/blog/#_5-2-搭建-nacos-配置中心.html">5.2 搭建 Nacos 配置中心</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="_003-nacos服务注册与配置中心" tabindex="-1"><a class="header-anchor" href="#_003-nacos服务注册与配置中心" aria-hidden="true">#</a> 003-Nacos服务注册与配置中心</h1><h2 id="_1-nacos-概述" tabindex="-1"><a class="header-anchor" href="#_1-nacos-概述" aria-hidden="true">#</a> 1-Nacos 概述</h2><p>官网地址：<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">https://nacos.io<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>GitHub地址：<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>以下的 Nacos 介绍来自 Nacos 官网：</p><p>Nacos /nɑ:kəʊs/ 是 Dynamic Naming and Configuration Service 的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p><p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p><h2 id="_2-nacos-的下载与安装" tabindex="-1"><a class="header-anchor" href="#_2-nacos-的下载与安装" aria-hidden="true">#</a> 2-Nacos 的下载与安装</h2><p>SpringCloud Alibaba 对应的 Nacos 版本可以在 SpringCloud Aibaba 的 <a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">Github 地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 查看，我这里下载的是 1.4.2 版本的 Nacos，下载地址为：<a href="https://github.com/alibaba/nacos/releases%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases。<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>下载完成后在本地解压即可，解压后的 bin 目录里存放的是 Nacos 的启动脚本，在不同的系统下执行相应的启动脚本即可启动 Nacos，例如，在 Windows 系统下双击执行 startup.cmd 文件，就可以启动 Nacos，但此时会报错，这是因为 Nacos 默认的启动模式是集群，可以通过如下命令，以单例模式启动 Nacos。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">startup.cmd</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-m</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">standalone</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动后，在浏览器访问 <a href="http://localhost:8848/nacos" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 即可进入 Nacos 的控制台的登陆界面，默认的用户名和密码都是 nacos。</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230609164217967.24zkxin9f940.png" alt="image-20230609164217967" tabindex="0" loading="lazy"><figcaption>image-20230609164217967</figcaption></figure><h2 id="_3-nacos-注册中心" tabindex="-1"><a class="header-anchor" href="#_3-nacos-注册中心" aria-hidden="true">#</a> 3-Nacos 注册中心</h2><h3 id="_3-1-服务注册中心介绍" tabindex="-1"><a class="header-anchor" href="#_3-1-服务注册中心介绍" aria-hidden="true">#</a> 3.1 服务注册中心介绍</h3><p>在微服务架构中，一个系统通常被拆分为多个模块 / 服务，在服务是单实例情况下，可以采用点对点的 HTTP 直接调用，即 IP + Port + 接口的形式。但模块 / 服务通常都是多实例集群部署，用以减轻服务器的压力。</p><p>在多实例集群部署服务时，我们不得不考虑如下几个问题：</p><ol><li>调用方如何知晓调用哪个实例？</li><li>当实例运行失败后，如何转移到别的实例上去处理请求？</li></ol><p>服务注册中心便是为了解决上述问题，将所有的服务统一的、动态的管理起来。<strong>所有的服务都与注册中心发生连接，由注册中心统一配置管理，不再由实例自身直接调用</strong>。</p><p>服务管理的过程大致如下：</p><ol><li>服务提供者启动时，将服务提供者的信息主动提交到服务注册中心进行服务注册。</li><li>服务调用者启动时，将服务提供者信息从注册中心下载到调用者本地，调用者从本地的服务提供者列表中，基于某种负载均衡策略选择一台服务实例发起远程调用，这是一个点到点调用的方式。</li><li>服务注册中心能够感知服务提供者某个实例下线，同时将该实例服务提供者信息从注册中心清除，并通知服务调用者集群中的每一个实例，告知服务调用者不再调用本实例，以免调用失败。</li></ol><h3 id="_3-2-搭建-nacos-注册中心" tabindex="-1"><a class="header-anchor" href="#_3-2-搭建-nacos-注册中心" aria-hidden="true">#</a> 3.2 搭建 Nacos 注册中心</h3><h4 id="_3-2-1-导入坐标" tabindex="-1"><a class="header-anchor" href="#_3-2-1-导入坐标" aria-hidden="true">#</a> 3.2.1 导入坐标</h4><p>所有的服务都需要注册到 Nacos 注册中心，这里将 Nacos 服务发现与注册的坐标导入 mall-services 模块中：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">com.alibaba.cloud</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">spring-cloud-starter-alibaba-nacos-discovery</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-nacos-服务发现配置" tabindex="-1"><a class="header-anchor" href="#_3-2-2-nacos-服务发现配置" aria-hidden="true">#</a> 3.2.2 Nacos 服务发现配置</h4><p>这里以 mall-user-server 服务为例，在 application.yml 中配置的 Nacos 服务发现的具体信息为：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user-server</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">127.0.0.1:8848</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># Nacos 服务地址</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;"># 服务注册的名称，默认是:spring.application.name</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span><span style="color:#D4D4D4;"> </span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;"># 服务注册的地址，默认是:spring.cloud.nacos.server-addr</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span><span style="color:#D4D4D4;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时，只需要在各个服务的启动类或配置类上加上 <code>@EnableDiscoveryClient</code> 注解用于开启服务注册与发现的支持，服务就可以注册到 Nacos，但经过实际测试不加 <code>@EnableDiscoveryClient</code> 注解，服务也能注册到 Nacos。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>在配置 <code>spring.application.name</code> 和 <code>spring.cloud.nacos.server-addr</code> 的前提下，可以不配置 <code>spring.cloud.nacos.service</code> 和 <code>spring.cloud.nacos.discovery</code>。</p></div><h3 id="_3-3-nacos-领域模型" tabindex="-1"><a class="header-anchor" href="#_3-3-nacos-领域模型" aria-hidden="true">#</a> 3.3 Nacos 领域模型</h3><p><strong>Nacos 领域模型描述了服务与实例之间的边界和层级关系。<strong>Nacos 的服务领域模型是以</strong>服务</strong>为维度构建起来的，这个服务并不是指集群中的单个服务器，而是指微服务的服务名。<strong>服务</strong>是 Nacos 中位于最上层的概念，在服务之下，还有<strong>集群</strong>和<strong>实例</strong>的概念。</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230609205457741.3ofjmn24h0i0.png" alt="image-20230609205457741" tabindex="0" loading="lazy"><figcaption>image-20230609205457741</figcaption></figure><h4 id="_3-2-1-服务" tabindex="-1"><a class="header-anchor" href="#_3-2-1-服务" aria-hidden="true">#</a> 3.2.1 服务</h4><p>在服务这个层级上可以配置元数据和服务保护阈值等信息。服务阈值是一个 0~1 之间的 数字，当服务的健康实例数与总实例的比例小于这个阈值的时候，说明能提供服务的机器已经 没多少了。这时候 Nacos 会开启服务保护模式，不再主动剔除服务实例，同时还会将不健康 的实例也返回给消费者。</p><h4 id="_3-2-2-集群" tabindex="-1"><a class="header-anchor" href="#_3-2-2-集群" aria-hidden="true">#</a> 3.2.2 集群</h4><p>一个服务由很多服务实例组成，在每个服务实例启动的时候，可以设置它所属的集群，在集群这个层级上，也可以配置元数据。除此之外，还可以为持久化节点设置健康检查模式。</p><p>所谓持久化节点，是一种会保存到 Nacos 服务端的节点，即便该节点的客户端进程没有在运行，节点也不会被服务端删除，只不过 Nacos 会将这个持久化节点的状态标记为不健康， Nacos 可以采用一种“主动探活”的方式来对持久化节点做健康检查。</p><p>除了持久化节点以外，大部分服务节点在 Nacos 中以 “临时节点” 的方式存在，它是默认的服务注册方式，从名字中就可以看出，这种节点不会被持久化保存在 Nacos 服务器，临时节点通过主动发送 heartbeat 请求向服务器报送自己的状态。</p><h4 id="_3-2-3-实例" tabindex="-1"><a class="header-anchor" href="#_3-2-3-实例" aria-hidden="true">#</a> 3.2.3 实例</h4><p>这里所说的实例就是指服务节点，可以在 Nacos 控制台查看每个实例的 IP 地址和端口、 编辑实例的元数据信息、修改它的上线 / 下线状态或者配置路由权重等等。</p><p>在这三个层级上都有 “元数据” 这一数据结构，可以把它理解为一组包含了服务描述信息（如服务版本等）和自定义标签的数据集合。Client 端通过服务发现技术可以获取到 每个服务实例的元数据，可以将自定义的属性加入到元数据并在 Client 端实现某些定制化的业务场景。</p><h3 id="_3-4-nacos-数据模型" tabindex="-1"><a class="header-anchor" href="#_3-4-nacos-数据模型" aria-hidden="true">#</a> 3.4 Nacos 数据模型</h3><p>Nacos 的数据模型有三个层次结构，分别是 Namespace、Group 和 Service/DataId。</p><ul><li><p>Namespace：即命名空间，它是最顶层的数据结构，可以用它来区分开发环境、生产环境等不同环境。默认情况下，所有服务都部署到一个叫做 “public” 的公共命名空间；</p></li><li><p>Group：在命名空间之下有一个分组结构，默认情况下所有微服务都属于 “DEFAULT_GROUP” 这个分组，不同分组间的微服务是相互隔离的；</p></li><li><p>Service/DataID：在 Group 分组之下，就是具体的微服务了，比如订单服务、商品服务等等。</p></li></ul><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230609210818177.74msn75ly0w0.png" alt="image-20230609210818177" tabindex="0" loading="lazy"><figcaption>image-20230609210818177</figcaption></figure><p>通过 Namespace + Group + Service/DataID，就可以精准定位到一个具体的微服务</p><h4 id="_3-4-1-namespace" tabindex="-1"><a class="header-anchor" href="#_3-4-1-namespace" aria-hidden="true">#</a> 3.4.1 Namespace</h4><p>不同的命名空间逻辑上是隔离的，不特殊设置的情况下，服务不会跨命名空间请求，命名空间主要的作用是区分服务使用的范围，比如开发、测试、生产可以分别设置三个命名空间来互相隔离。在不设置的情况下，只有一个保留空间 public。</p><p>设置命名空间也很简单，首先在 nacos 控制台新建命名空间，如下图所示：</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230609211316753.1n47u116f600.png" alt="image-20230609211316753" tabindex="0" loading="lazy"><figcaption>image-20230609211316753</figcaption></figure><p>在创建命名空间时，我们不必填写命名空间 ID，系统会自动生成，可以在控制台查看命名空间的 ID。接下来就可以在 Nacos 的注册配置中将服务注册到此命名空间下，例如这里将 mall-user 服务注册到此命名空间下，代码如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">namespace</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">4331959a-47d7-48d1-8995-1e606968dfe1</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># Nacos 控制台生成的命名空间ID</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-group" tabindex="-1"><a class="header-anchor" href="#_3-4-2-group" aria-hidden="true">#</a> 3.4.2 Group</h4><p>Group 可以在 Namespace 基础上进行更加细致的隔离，Group 具体的使用场景主要有如下几个方面：</p><ol><li>配置分组</li></ol><p>Group 的最常用的场景就是配置分组，一个命名空间下的一些服务都用到了一些相同的配置，就可以将这些服务分配到同一个组中，再将这些服务都用到的配置信息，抽取为改分组下的一个配置文件，这样只有在该分组的服务才能使用这个配置文件。</p><ol start="2"><li>服务分类</li></ol><p>在企业级应用系统中，通常会有多个服务同时运行，可能包含了不同功能、不同频率和不同负载的服务。使用 Nacos 的 Group 功能可以将这些服务按照自定义的规则进行分类，以便更好地区分和管理。</p><ol start="3"><li>灰度发布</li></ol><p>灰度发布是基于服务的，在 Nacos 中服务的 Group 就是实现灰度发布的关键，在灰度发布中，通常将新版本的服务和旧版本的服务同时运行一段时间，然后再逐步将新版本的服务全部投入使用。可以将新版本的服务和旧版本的服务归类到不同的组中，通过不断调节不同组的服务权重来实现灰度发布。</p><h2 id="_4-nacos-集群" tabindex="-1"><a class="header-anchor" href="#_4-nacos-集群" aria-hidden="true">#</a> 4 Nacos 集群</h2><p>Nacos 支持两种部署模式：单机模式和集群模式。在开发中，我们习惯用单机模式快速构建一个 Nacos 开发/测试环境，而在生产中，出于高可用的考虑，一定需要使用 Nacos 集群部署模式。Nacos 为高可用做了非常多的特性支持，而这些高可用特性大多数都依赖于集群部署模式。</p><h3 id="_4-1-nacos-集群架构" tabindex="-1"><a class="header-anchor" href="#_4-1-nacos-集群架构" aria-hidden="true">#</a> 4.1 Nacos 集群架构</h3><p>下图是 Nacos 官方文档给出的 Nacos 集群部署架构图，其中的 SLB 表示负载均衡，外部服务向 Nacos 发起注册时，首先会经过 SLB，通常使用 Nginx，为了保证高可用 Nginx 也可以做集群，通过 Nginx 来分发到具体的 Nacos 服务器上面。</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/deployDnsVipMode.3bnwy73qeqm0.jpg" alt="deployDnsVipMode" tabindex="0" loading="lazy"><figcaption>deployDnsVipMode</figcaption></figure><h3 id="_4-2-数据持久化配置" tabindex="-1"><a class="header-anchor" href="#_4-2-数据持久化配置" aria-hidden="true">#</a> 4.2 数据持久化配置</h3><p>Nacos 默认数据存储在内嵌数据库 Derby 中，不属于生产可用的数据库。官方推荐的最佳实践是使用带有主从的高可用数据库集群，这里以单点的外部数据库 MySQL 为例。可以使用 Docker 在虚拟机上安装 MySQL，命令如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">docker</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">run</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-p</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">3306</span><span style="color:#CE9178;">:3306</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">--name</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">mysql</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-v</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">/docker/mysql/logs:/logs</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-v</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">/docker/mysql/data:/var/lib/mysql</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-v</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">/docker/mysql/conf:/etc/mysql/conf.d</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-e</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#569CD6;">-d</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">mysql:8.0.17</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先，在 nacos 安装目录的 conf 目录下找到 nacos-mysql.sql 文件，需要在名为 nacos_config 的数据库中执行这个文件。</p><p>接着，在 nacos 安装目录的 conf 目录下找到 application.properties 文件，修改其中的数据库配置，除了下面的数据库平台配置和数据库数量配置外，还要保证连接的数据库地址的正确性。</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring.datasource.platform</span><span style="color:#D4D4D4;">=mysql </span><span style="color:#6A9955;"># 使用mysql数据库</span></span>
<span class="line"><span style="color:#569CD6;">db.num</span><span style="color:#D4D4D4;">=1 </span><span style="color:#6A9955;"># 数据库的数量</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-搭建-nacos-集群" tabindex="-1"><a class="header-anchor" href="#_4-3-搭建-nacos-集群" aria-hidden="true">#</a> 4.3 搭建 Nacos 集群</h3><h4 id="_4-3-1-nacos-集群配置" tabindex="-1"><a class="header-anchor" href="#_4-3-1-nacos-集群配置" aria-hidden="true">#</a> 4.3.1 Nacos 集群配置</h4><p>在做好 Nacos 持久化之后，需要在 Nacos 安装目录的 conf 目录下，将 cluster.conf.example 文件重命名为 cluster.conf，然后打开这个文件，添加需要集群 Nacos 的 IP 信息。</p><p>这里采用在本地机器上启动三个 Nacos 实例为例，来说明 Nacos 的集群部署。需要在 cluster.conf 集群配置文件中添加本地及其不同端口的三个 Nacos IP 信息，这里需要保证保证端口不连续，否则会出现集群异常。下面是我本地配置的三台 Nacos IP 信息：</p><table><thead><tr><th>Nacos 服务</th><th>IP</th></tr></thead><tbody><tr><td>nacos server 8848</td><td>192.168.0.107:8848</td></tr><tr><td>nacos server 8858</td><td>192.168.0.107:8858</td></tr><tr><td>nacos server 8868</td><td>192.168.0.107:8868</td></tr></tbody></table><p>然后，将 Nacos 安装目录复制三份，分别命名为 nacos-8848、nacos-8858、nacos-8868。</p><p>最后，需要分别修改这三个 Nacos 的 application.properties 中配置的 Nacos 端口，需要和 Nacos 的 IP 信息 一一对应。</p><h4 id="_4-3-2-nginx-配置" tabindex="-1"><a class="header-anchor" href="#_4-3-2-nginx-配置" aria-hidden="true">#</a> 4.3.2 Nginx 配置</h4><p>这里以 Windows 版的 Nginx 为例，修改其 conf 目录下的 nginx.conf 文件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">upstream nacos-cluster {</span></span>
<span class="line"><span style="color:#D4D4D4;">    server </span><span style="color:#B5CEA8;">192.168</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">0</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">107</span><span style="color:#C586C0;">:</span><span style="color:#B5CEA8;">8848</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    server </span><span style="color:#B5CEA8;">192.168</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">0</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">107</span><span style="color:#C586C0;">:</span><span style="color:#B5CEA8;">8858</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    server </span><span style="color:#B5CEA8;">192.168</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">0</span><span style="color:#D4D4D4;">.</span><span style="color:#F44747;">107</span><span style="color:#C586C0;">:</span><span style="color:#B5CEA8;">8868</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">server {</span></span>
<span class="line"><span style="color:#D4D4D4;">    listen       </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    server_name  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    location /nacos {</span></span>
<span class="line"><span style="color:#D4D4D4;">        proxy_pass http</span><span style="color:#C586C0;">:</span><span style="color:#6A9955;">//nacos-cluster;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 192.168.0.107 为本机电脑的 IPv4 地址。如果使用 127.0.0.1，Nacos 集群启动后，不仅会注册 127.0.0.1 相应的集群，也会注册 192.168.0.107 相应的集群。</p><p>启动 Nginx 后，即可访问 <a href="http://localhost:80/nacos" target="_blank" rel="noopener noreferrer">http://localhost:80/nacos<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 来检查是否代理成功：</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230707094529973.4xdi7gxvv180.png" alt="image-20230707094529973" tabindex="0" loading="lazy"><figcaption>image-20230707094529973</figcaption></figure><p>可以通过如下配置将服务注册到搭建的 Nacos 集群上：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">port</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">7000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.107:80</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">cluster-name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">Shanghai</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># 集群名字，可以用地区命名,默认的集群名字为 DEFAULT</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-权重策略" tabindex="-1"><a class="header-anchor" href="#_4-4-权重策略" aria-hidden="true">#</a> 4.4 权重策略</h3><p>在项目的实际部署过程中，不同机器之间存在性能差异，我们希望性能好的机器承担更多的用户请求，但默认情况下 NacosRule 是同集群内随机挑选，不会考虑机器性能问题。</p><p>SpringCloud Alibaba Nacos 默认提供了名为 <code>NacosLoadBalancer</code> 的负载均衡规则，其负载均衡规则首先会选择同一个集群下的服务，然后再根据服务的权重进行选择。</p><p>默认情况下，Nacos 的权重选择是关闭的，仅仅使用轮询策略，可使用如下配置来开启 Nacos 的权重策略：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">loadbalancer</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      	</span><span style="color:#569CD6;">enabled</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nacos 的权重配置可以在 Nacos 控制台进行配置，其值介于 0~1 之间，权重越大则访问频率越高，权重为 0 的 Nacos 实例永远不会被访问。</p><blockquote><p>如果未给服务器设置权重，建议不要使用基于权重的策略，因为如果微服务的权重都相同，相当于随机</p></blockquote><p>我们可以在本地再启动一份 mall-user-server，配置如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">port</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">7001</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user-server</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.107:80</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">cluster-name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">Shanghai</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在就可以在 Nacos 的 Shanghai 集群里看到两个 mall-user-server 实例了</p><figure><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/image-20230707100922402.1ny8yvotse8w.png" alt="image-20230707100922402" tabindex="0" loading="lazy"><figcaption>image-20230707100922402</figcaption></figure><h3 id="_4-5-临时-持久化实例" tabindex="-1"><a class="header-anchor" href="#_4-5-临时-持久化实例" aria-hidden="true">#</a> 4.5 临时/持久化实例</h3><p>注册到 Nacos 的服务实例默认都是临时实例，临时实例每隔一段时间想 Nacos 发送一个心跳请求来告诉 Nacos 自己还活着，和 Eureka 一样，如果心跳停止，则 Nacos 会将其从服务列表中剔除。</p><p>对于持久化实例 Nacos 会主动发送请求询问其是否活着，若是死了，则会等待其恢复健康，而并不是剔除。可以通过如下配置将服务注册为持久化实例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.107:80</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">cluster-name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">Shanghai</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">namespace</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">f354ee02-7bd3-4743-bcd1-b5683b5050a7</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">ephemeral</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># 注册持久化实例</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里新建了一个命名空间，这是因为 <strong>public 命名空间下的服务是无法被注册为持久化实例的</strong>。</p><h3 id="_4-6-保护阈值" tabindex="-1"><a class="header-anchor" href="#_4-6-保护阈值" aria-hidden="true">#</a> 4.6 保护阈值</h3><p>Nacos 设计了临时实例和持久化实两种服务注册模式，这与 Nacos 的保护阈值息息相关。本质上，保护阈值是⼀个⽐例值（当前服务健康实例数/当前服务总实例数）。</p><p>服务消费者从 Nacos 拉去服务时，获取的实例有健康可不健康之分，Nacos 在返回实例时，只会返回健康实例。</p><p>但在⾼并发、⼤流量场景会存在⼀定的问题。比如，服务 A 有 100 个实例，其中 98 个实例都处于不健康状态，如果 Nacos 只返回其中的两个健康实例的话。流量洪峰的到来可能会直接打垮这两个服务，进一步产生雪崩效应。</p><p>若（当前服务健康实例数/当前服务总实例数）&lt; 保护阈值时，Nacos 会把该服务所有的实例信息（健康的+不健康的）全部提供给消费者，消费者可能访问到不健康的实例，请求失败，但这样也⽐造成雪崩要好。牺牲了⼀些请求，保证了整个系统的可⽤。</p><p>所以，对于永久实例来说，即使它们挂掉了，状态为不健康的，但当触发保护阈值时，还是可以起到分流的作用，这就是 Nacos 设计两种服务注册模式的意义。</p><h2 id="_5-nacos-配置中心" tabindex="-1"><a class="header-anchor" href="#_5-nacos-配置中心" aria-hidden="true">#</a> 5-Nacos 配置中心</h2><h3 id="_5-1-服务配置中心介绍" tabindex="-1"><a class="header-anchor" href="#_5-1-服务配置中心介绍" aria-hidden="true">#</a> 5.1 服务配置中心介绍</h3><p>顾名思义，配置中心就是一个统一存放配置的地方。为什么我们会需要配置中心？</p><p>在没有配置中心之前，项目的配置存在如下问题：</p><ol><li>采用本地静态配置，无法保证实时性：修改配置不灵活且需要经过较长的测试发布周期，无法尽快通知到客户端，还有些配置对实时性要求很高，比方说主备切换配置或者碰上故障需要修改配置，这时通过传统的静态配置或者重新发布的方式去配置，那么响应速度是非常慢的，业务风险非常大；</li><li>易引发生产事故：比如在发布的时候，容易将测试环境的配置带到生产上，引发生产事故；</li><li>配置散乱且格式不标准：有的用 properties 格式，有的用 xml 格式，还有的存储在数据库中；</li><li>配置缺乏安全审计、版本控制、配置权限控制功能：谁？在什么时间？修改了什么配置？无从追溯，出了问题也无法及时回滚到上一个版本；无法对配置的变更发布进行认证授权，所有人都能修改和发布配置。</li></ol><p>而配置中心区别于传统的配置信息分散到系统各个角落的方式，对系统中的配置文件进行集中统一管理，而不需要逐一对单个的服务器进行管理。那这样做有什么好处呢？</p><ol><li>通过配置中心，可以使得配置标准化、格式统一化；</li><li>当配置信息发生变动时，修改实时生效，无需要重新重启服务器，就能够自动感知相应的变化，并将新的变化统一发送到相应程序上，快速响应变化。</li><li>将配置和发布包解藕进一步提升发布的成功率，并为运维的细力度管控、应急处理等提供强有力的支持。</li></ol><h3 id="_5-2-搭建-nacos-配置中心" tabindex="-1"><a class="header-anchor" href="#_5-2-搭建-nacos-配置中心" aria-hidden="true">#</a> 5.2 搭建 Nacos 配置中心</h3><h4 id="_5-2-1-导入坐标" tabindex="-1"><a class="header-anchor" href="#_5-2-1-导入坐标" aria-hidden="true">#</a> 5.2.1 导入坐标</h4><p>每个服务都需要使用 Nacos 配置中心，将其坐标导入 mall-services 模块下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">dependencies</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">com.alibaba.cloud</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">spring-cloud-starter-alibaba-nacos-config</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">org.springframework.cloud</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">groupId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">spring-cloud-starter-bootstrap</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">artifactId</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">dependency</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">dependencies</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从 SpringCloud 2020 版本后不再默认加载 bootstrap 文件，如果需要加载 bootstrap 文件，则需要手动添加依赖。</p><h4 id="_5-2-2-nacos-配置中心配置" tabindex="-1"><a class="header-anchor" href="#_5-2-2-nacos-配置中心配置" aria-hidden="true">#</a> 5.2.2 Nacos 配置中心配置</h4><p>搭建 Nacos 配置中心时，需要将 Nacos 的配置中心信息放到 <code>bootstrap.yml</code> 文件中？</p><p>微服务要拉取 Nacos 中管理的配置，并且与本地的 <code>application.yml</code> 配置<strong>合并</strong>，才能完成项目启动，但本地尚未读取 <code>application.yml</code> 又如何获取 Nacos 配置中心地址呢？</p><p>除了 <code>application.yml</code> 配置文件外，SpringBoot 还提供了另一种配置文件 <code>bootstrap.yml</code> 文件，会在 <code>application.yml</code> 之前被读取，而且发生在拉取 Nacos 配置中心信息之前。</p><p>以 mall-user-server 服务为例，搭建 Nacos 的配置中心，可以在其 bootstrap.yml 中配置如下信息：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.107:8848</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">config</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># nacos 配置中心地址</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">file-extension</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">yml</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># nacos 配置文件格式</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">prefix</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;"># nacos 配置中心名字</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">profiles</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">active</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user-server</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-在-nacos-中添加配置信息" tabindex="-1"><a class="header-anchor" href="#_5-2-3-在-nacos-中添加配置信息" aria-hidden="true">#</a> 5.2.3 在 Nacos 中添加配置信息</h4><p>点击 Nacos 控制台配置列表右上角的 “+” 号，即可进入新建配置页面，不同服务的配置是通过 <code>Data ID</code> 来区分的，其命名规则为：<code>${prefix}-${spring.profiles.active}.${file-extension}</code></p><ul><li><p>prefix 默认为 <code>spring.application.name</code> 的值，也可以通过 <code>spring.cloud.nacos.config.prefix</code> 来指定；</p></li><li><p><code>spring.profiles.active</code> 即为当前环境对应的 profile，当 <code>spring.profiles.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></p></li><li><p><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 properties 和 yaml 类型。</p></li></ul><p>如果我们要为 mall-user-server 添加配置信息，则其 Data ID 为：<code>mall-user-server-dev.yml</code>。</p><p>既然服务需要拉取 Nacos 配置中心管理的配置再与本地的 <code>application.yml</code> 中的配置进行合并，那么我们就可以只在本地保存 Nacos 拉取和注册需要的配置信息，将其它的配置信息都放到 Nacos，下面是 mall-user-server 的具体配置。</p><p><strong>bootstrap.yml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">port</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">7000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user-server</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.107:8848</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">config</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">file-extension</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">yml</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">prefix</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">profiles</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">active</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Nacos 配置中心配置</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">datasource</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">driver-class-name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">url</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">jdbc://mysql:localhost:3306/mall_ums</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">username</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">root</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">password</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">root</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-4-配置热更新" tabindex="-1"><a class="header-anchor" href="#_5-2-4-配置热更新" aria-hidden="true">#</a> 5.2.4 配置热更新</h4><p>Nacos 也是支持配置的热更新的，下面以阿里云短信服务来介绍两种 Nacos 热更新的使用方式。</p><p>首先，在 mall-user-server 的 Nacos 配置中心上添加阿里云的短信服务配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">sms</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">accessKey</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">LTAI5tMGtKPbL2bCp6zSU4Bz</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">accessKeySecret</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">baAdNzxAjnIMKU3wroxZLlpAACpy02</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">signName</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">gtzk</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">templateCode</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">SMS_183195440</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">doMain</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">dysmsapi.aliyuncs.com</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">regionId</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">cn-hangzhou</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>方式一：在 @Value 注入的变量所在类上添加注解 <strong>@RefreshScope</strong></p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">RestController</span></span>
<span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">RefreshScope</span></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">AliSmsController</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">Value</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;${sms.accessKey}&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">accessKey</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">Value</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;${sms.accessKeySecret}&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">accessKeySecret</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">Value</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;${sms.signName}&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">signName</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">Value</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;${sms.templateCode}&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">templateCode</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">GetMapping</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;method1&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Map</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">,</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#DCDCAA;">method1</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Map</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">,</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">HashMap</span><span style="color:#D4D4D4;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;accessKey&quot;</span><span style="color:#D4D4D4;">,accessKey);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;accessKeySecret&quot;</span><span style="color:#D4D4D4;">,accessKeySecret);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;signName&quot;</span><span style="color:#D4D4D4;">,signName);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;templateCode&quot;</span><span style="color:#D4D4D4;">,templateCode);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> result;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>方式二：使用 @ConfigurationProperties 注解</p></blockquote><p>使用 <code>@ConfigurationProperties</code> 注解读取配置文件，不需要加 <code>@RefreshScope</code> 注解，就可以实现配置的热更新，一般也是使用这种方式。</p><p>首先，使用 <code>@ConfigurationProperties</code> 注解定义 sms 的配置：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">ConfigurationProperties</span><span style="color:#D4D4D4;">(prefix = </span><span style="color:#CE9178;">&quot;sms&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">Component</span></span>
<span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">Data</span></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">AliSmsProperties</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">accessKey</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">accessKeySecret</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">signName</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">templateCode</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着使用 @Autowired 注解在使用处注入即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">RestController</span></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">UserController</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">Autowired</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">AliSmsProperties</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">aliSmsProperties</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    @</span><span style="color:#4EC9B0;">GetMapping</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;method2&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Map</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">,</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#DCDCAA;">method2</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Map</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">,</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">HashMap</span><span style="color:#D4D4D4;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;accessKey&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">aliSmsProperties</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getAccessKey</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;accessKeySecret&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">aliSmsProperties</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getAccessKeySecret</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;signName&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">aliSmsProperties</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSignName</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">result</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">put</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;templateCode&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#9CDCFE;">aliSmsProperties</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getTemplateCode</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> result;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-5-多个服务共享配置" tabindex="-1"><a class="header-anchor" href="#_5-2-5-多个服务共享配置" aria-hidden="true">#</a> 5.2.5 多个服务共享配置</h4><p>在实际开发过程中，如果遇到多个服务用到相同的配置，可以将重复的配置抽取出来，然后在每个服务中引用即可。例如，我们在 Nacos 配置中心新建了一个 common.yml 的配置文件，则可以使用如下方式在每个服务中引用：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">port</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">7000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">spring</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">mall-user-server</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">cloud</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">nacos</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">192.168.0.110:8848</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">discovery</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">service</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">config</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">server-addr</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.cloud.nacos.server-addr}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">file-extension</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">yml</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">prefix</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">${spring.application.name}</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">shared-configs</span><span style="color:#D4D4D4;">: </span><span style="color:#6A9955;"># 共享配置列表</span></span>
<span class="line"><span style="color:#D4D4D4;">          - </span><span style="color:#569CD6;">data-id</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">common.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">profiles</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">active</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/mengyahui/blog/edit/main/src/back/springcloud/003-Nacos服务注册与配置中心.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 2772540969@qq.com">deer</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="md-link nav-link prev" href="/blog/back/springcloud/002-SpringCloud%E6%A1%88%E4%BE%8B%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->002-SpringCloud案例项目搭建</div></a><!----></nav><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><!----></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-f0ac02dd.js" defer></script>
  </body>
</html>
